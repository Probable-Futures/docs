
  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8">
      <title>Probable Futures Map</title>
      <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
      <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
      <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.css" type="text/css">
      <style>
        body {margin: 0; padding: 0; font-family: LinearSans, Arial, Helvetica, sans-serif; font-size: 16px; color: #2a172d; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;overflow-x: hidden;}
        a {color: #1c101e;}
        a:hover {color: #851fff;}
        @font-face { font-family: "LinearSans"; src: url("https://pf-fonts.s3.us-west-2.amazonaws.com/LinearSans-Regular.otf") format("opentype"); font-weight: 400; font-style: normal;}
        @font-face { font-family: "LinearSans"; src: url("https://pf-fonts.s3.us-west-2.amazonaws.com/linear-sans-semibold.eot"); src: url("https://pf-fonts.s3.us-west-2.amazonaws.com/linear-sans-semibold.eot?#iefix") format("embedded-opentype"), url("https://pf-fonts.s3.us-west-2.amazonaws.com/linear-sans-semibold.woff2") format("woff2"), url("https://pf-fonts.s3.us-west-2.amazonaws.com/linear-sans-semibold.woff") format("woff"); font-weight: 600; font-style: normal;}
        @font-face { font-family: "RelativeMono"; src: url("https://pf-fonts.s3.us-west-2.amazonaws.com/relative-mono-10-pitch-pro.otf") format("opentype"); font-weight: 400; font-style: normal;}
        @font-face { font-family: "Cambon"; src: url("https://pf-fonts.s3.us-west-2.amazonaws.com/Cambon-Regular.otf") format("opentype"); font-weight: 400; font-style: normal;}
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .mapboxgl-ctrl-top-right { top: 50%; transform: translateY(-50%);}
        .mapboxgl-ctrl.mapboxgl-ctrl-group { box-shadow: 0 3px 5px 0 rgb(56 22 63 / 50%); border-radius: 6px; background-color: #fdfdfd; margin-right: 20px;} 
        .mapboxgl-ctrl.mapboxgl-ctrl-group button { width: 35px; height: 35px; border: none; outline: 0; font-family: "LinearSans"; color: #1b1a1c; border-bottom-left-radius: 6px; border-bottom-right-radius: 6px;}
        .mapboxgl-ctrl.mapboxgl-ctrl-group button:first-child { border-top-left-radius: 6px; border-top-right-radius: 6px; border-bottom: 1px solid rgba(151,151,151,0.5); border-bottom-left-radius: unset; border-bottom-right-radius: unset;}
        .mapboxgl-ctrl.mapboxgl-ctrl-group button:last-child {display: none;}
        .mapboxgl-map {font: unset;}
        .mapboxgl-ctrl-attrib-inner a {font-size: 10px; font-family: Helvetica Neue, Arial, Helvetica, sans-serif; line-height: 20px;}
        .mapboxgl-ctrl-attrib.mapboxgl-compact {transform: scale(0.7); margin-bottom: -1px;}
        .mapboxgl-ctrl-bottom-left {left: unset; right: 45px; z-index:1;}
        @media (min-width: 641px) {.mapboxgl-ctrl-bottom-left {right: 10px; bottom: 15px;}}
        @media (min-width: 1200px) {.mapboxgl-ctrl-bottom-left {bottom: 15px; left: unset; right: 10px;}}
        .mapboxgl-ctrl-bottom-right {right: 0; bottom: 0;}
        @media (max-width: 641px) {
          .mapboxgl-compact-show {margin-right: -18px!important;}
          .mapboxgl-ctrl-logo {transform: scale(0.9); height: 18px!important; margin: 0 -26px -8px -4px!important;}
        }
        .mapbox-improve-map {font-weight: 700;}
        /*popover*/
        .popover-title {display: block;max-width: 210px;color: #1c101e;font-size: 12px;font-weight: 600;line-height: 14px;margin-right: 25px;}
        .popover-title:first-letter{text-transform: uppercase;}
        .popover-description{font-weight: 400;font-size: 10px;max-width: 209px;line-height: 14px;padding: 4px 0px;}
        .popover-no-data {display: block;color: #000000;font-weight: 600;letter-spacing: 0;text-align: center;margin-top: 10px;margin-bottom: 16px;font-size: 20px;}
        .popover-row-container {display: flex;justify-content: center;margin-top: 10px;padding-bottom: 18px;text-align: center;gap: 20px;}
        .popover-value-container {display: flex;flex-direction: column;align-items: center;justify-content: space-around;gap: 5px;}
        .popover-value {display: block;color: #000000;font-weight: 600;letter-spacing: 0;}
        .popover-label {display: block;max-width: 80px;color: #000000;font-size: 10px;letter-spacing: 0;line-height: 10px;text-align: center;box-sizing: border-box;padding: 0px 4px;}
        .popover-label:first-letter{text-transform: lowercase;}
        .popover-mean-frequency-text {display: block;color: #000000;font-weight: 600;letter-spacing: 0;font-size: 20px;}
        .popover-avg-value {display: block;color: #000000;font-weight: 600;letter-spacing: 0;}
        .mapboxgl-popup-content{background-color: #fdfdfd;border-radius: 0;border: 1px solid #2a172d;padding: 16px 16px 0;box-sizing: border-box;box-shadow: none;}
        .mapboxgl-popup-close-button{position: absolute;top: 8px;right: 12px;font-size: 25px;width: 20px;height: 20px;}
        .mapboxgl-popup-close-button:hover{background: transparent;}
        .mapboxgl-popup-tip{width: 12px;height: 12px;transform: rotate(45deg);background-color: #fdfdfd;border-width: 1px !important;margin-bottom: -8px;border-left: 1px solid #2a172d;border-top: 1px solid #2a172d!important;box-sizing: content-box;align-self: center;border-bottom-color: #fff;}
        #beforeMap, #afterMap {overflow: hidden;position: absolute;height: 100%;z-index: 1;user-select: none;width: 100%;}
        .comparison-container {overflow: hidden;position: relative;height: 100%;z-index: 1;}
        .mapboxgl-compare {background-color: rgb(42, 23, 45);height: 100%;position: absolute;width: 2px;z-index: 1;}
        .mapboxgl-compare .compare-swiper-vertical {background-color: #1b1a1c;background-repeat: no-repeat, no-repeat;background-size: 41px;border-radius: 50%;box-shadow: #f8f9f3 0 0 0 2px inset;color: #f8f9f3;cursor: ew-resize;display: inline-block;height: 40px;left: -20px;margin: -20px 1px 0;position: absolute;top: 50%;width: 40px; transition: top 0.5s ease-in-out;}
        .mapboxgl-compare .compare-swiper-vertical::before,
        .mapboxgl-compare .compare-swiper-vertical::after {background-color: #1b1a1c;border: 1px solid #fefffc;color: #f8f9f3;display: block;font-family: RelativeMono,monospace;font-size: 15px;line-height: 1;padding: 2px 0 4px 0;position: absolute;text-align: center;top: 10px;width: 62px;}
        
  .embeddable-map-header {font-family: LinearSans, Arial, Helvetica, sans-serif;border: 1px solid #2a172d;background-color: #fdfdfd;padding: 15px 10px;position: relative;font-size: 16px;top: 20px;left: 20px;margin-right: 40px;display: inline-block;z-index: 1;}
  .embeddable-map-title {font-size: 10px;font-weight: 600;letter-spacing: 0.8px;line-height: 11px;text-transform: uppercase;margin-bottom: 5px;}
  .embeddable-map-header-description {margin: 0;font-size: 18px;font-weight: bold;}

        
  .embeddable-key-container {position: absolute;min-width: 280px;top: unset;right: 20px;left: 20px;bottom: 20px;z-index: 1;width: auto;font-family: LinearSans, Arial, Helvetica, sans-serif;}
  .map-key-container {border: 1px solid #2a172d;padding: 12px 18px 9px;background-color: #fdfdfd;border-bottom: 1px solid #2a172d;}
  .embeddable-key-content {display: inline-block;width: 100%;}
  .map-key-header {display: flex;flex-direction: row;justify-content: space-between;align-items: center;margin-bottom: 10px;}
  .map-key-label {display: block;font-size: 10px;color: #2a172d;font-weight: 600;letter-spacing: 0.8px;line-height: 11px;text-transform: uppercase;margin-bottom: 8px;}
  .map-key-row {display: flex;width: 100%;}
  .map-key-bins-container {display: flex;align-items: flex-start;width: 100%;}
  .map-key-bin-container {display: flex;flex-direction: column;margin-right: 2px;min-width: 43px;flex: 1;max-width: 120px;}
  .map-key-color {height: 12px;}
  .map-key-bin {font-family: "RelativeMono", Courier, monospace;color: #2a172d;font-size: 9px;letter-spacing: 0;line-height: 16px;text-align: center;margin-top: 2px;display: flex;justify-content: space-evenly;}
  .map-key-bin .dash {font-size: 13px;}
  .map-key-inner-bin-label {display: flex;}
  .embeddable-bottom-link {position: absolute;left: 0;padding: 0 5px;background-color: rgba(255, 255, 255, 0.5);font-size: 12px;font-family: Helvetica Neue, Arial, Helvetica, sans-serif;line-height: 20px;color: rgba(0, 0, 0, 0.75);z-index: 3;cursor: pointer;text-decoration: none;bottom: 0;}
  @media (orientation: landscape) {.map-key-bin {font-size: 10px;}}
  @media (min-width: 768px) {.map-key-bin {font-size: 9px;}}
  @media (min-width: 768px) {.embeddable-key-container {right: unset; min-width: 480px;}}
  @media (min-width: 1200px) {.map-key-bin {font-size: 13px;margin-top: 4px;}}
  @media (min-width: 1200px) {.map-key-color {height: 14px;}}
  @media (orientation: landscape) {.map-key-bin-container {min-width: 43px;}}
  @media (min-width: 768px) {.map-key-bin-container {min-width: 47px;}}
  @media (min-width: 1200px) {.map-key-bin-container {margin-right: 3px;min-width: 80px;}}
  @media (min-width: 768px) {.map-key-bins-container {margin-right: 13px;}}
  @media (min-width: 1200px) {.map-key-bins-container {margin-right: 0;}}
  @media (min-width: 1200px) {.map-key-label {margin-bottom: 8px;}}
  @media (min-width: 1200px) {.map-key-header { margin-bottom: 10px;}}
  @media (min-width: 1200px) {.map-key-inner-bin-label { gap: 5px; }}
  /*Key toggle*/
  .embeddable-toggle-container {margin-top: -6px;}
  .embeddable-toggle {position: relative;width: 62px;height: 22px;background-color: #fdfdfd;border-radius: 4px;margin: 0 5px;border: 1px solid #2a172d;box-sizing: border-box;display: flex;font-family: "RelativeMono";font-size: 13px;letter-spacing: 0;line-height: 16px;text-align: center;user-select: none; align-items: center;}
  .embeddable-toggle .toggle-span {position: absolute;top: 2px;left: 3px;width: 25px;height: 16px;border-radius: 4px;transition: 0.2s;background-color: #2a172d;}
  .embeddable-toggle-label {display: flex;align-items: center;justify-content: space-between;cursor: pointer;}
  .embeddable-toggle-label:active .toggle-span {width: 30px;}
  .embeddable-toggle-label:hover .embeddable-toggle {border: 1px solid #8C6FF1;}
  .embeddable-toggle-label:hover .toggle-span {background-color: #8C6FF1;}
  .embeddable-toggle-input {display: none;}
  .embeddable-toggle-input:checked + .embeddable-toggle-label .toggle-span {left: calc(100% - 3px);transform: translateX(-100%);}
  .embeddable-toggle-option {flex: 1;   transition: color 0.6s ease;z-index: 1;}
  @media (min-width: 1200px) {.embeddable-toggle-container {margin-bottom: 14px; margin-top: 0px;}}
  @media (min-width: 1200px) {.embeddable-toggle {margin: 0 7px 0 9px;}}
  /* Climate Zones key*/
  .climate-zones-key-container {white-space: nowrap;box-sizing: content-box;padding: 0px;padding-left: 16px;width: auto;height: 80px;overflow-x: scroll;background-color: #fdfdfd;border: 1px solid #2a172d;display: flex;align-items: center;}
  .cz-bins-container {display: grid;grid-template-columns: auto auto auto auto auto auto;margin-bottom: 10px;grid-column-gap: 40px;margin-right: -20px;}
  .cz-bin-container {display: flex;flex-direction: column;flex: 1;gap: 15px;position: relative;margin-top: 2px;}
  .cz-bin-container:not(:last-child):after {content: "";display: block;position: absolute;top: 20px;right: -21px;bottom: 0;width: 1px;background-color: #adadad;height: 22px;}
  .cz-color-bin-wrapper {display: flex;align-items: center;gap: 10px;}
  .cz-key-color {height: 10px;width: 10px;aspect-ratio: 1/1;}
  .cz-group-name {font-size: 12px;line-height: 11px;font-family: LinearSans;}
  @media (min-width: 1200px) {.cz-bin-container {margin-top: 0px;gap: 20px;}}
  @media (min-width: 1200px) {.cz-bin-container:not(:last-child):after {height: 32px;}}
  @media (min-width: 768px) {.climate-zones-key-container {overflow-x: hidden;}}

        
  .reset-map-button:hover {background-color: rgb(0 0 0 / 5%)!important;}

      </style>
      <style id="dynamic-slider-styles">
        .mapboxgl-compare .compare-swiper-vertical::before {content: "1°C";left: -71px;}  
        .mapboxgl-compare .compare-swiper-vertical::after {content: "3°C";right: -71px;}
      </style>
      <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
      <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.js"></script>
      <!-- Open Graph / Facebook -->
      <meta property="og:title" content="Probable Futures Map" />
      <meta
        property="og:description"
        content="Probable Futures aims to increase the chances that the future is good. We offer useful tools to visualize climate change along with stories and insights to help people understand what those changes mean."
        data-react-helmet="true"
      />
      <meta property="og:type" content="website" />
      <meta
        property="og:image"
        content="http://probablefutures.org/assets/images/pf-gradient-1.jpg"
      />
      <meta property="og:image:width" content="1920" />
      <meta property="og:image:height" content="1080" />
      <meta property="og:url" content="http://probablefutures.org" />
  
      <!-- Twitter -->
      <meta name="twitter:title" content="Probable Futures Map" />
      <meta name="twitter:card" content="summary" />
      <meta
        name="twitter:description"
        content="Probable Futures aims to increase the chances that the future is good. We offer useful tools to visualize climate change along with stories and insights to help people understand what those changes mean."
        data-react-helmet="true"
      />
      <meta
        property="twitter:image"
        content="http://probablefutures.org/assets/images/pf-gradient-1.jpg"
      />
      <meta name="twitter:url" content="http://probablefutures.org" />
    </head>
    <body>
      <div id="comparison-container"><div id="beforeMap"></div><div id="afterMap"></div></div>
      <script>
        (function() {
          const datasetsWithMidValuesOnly = [40612,40613,40701,40702,40901];
          function cToF(value) {
            return Math.floor((value * 9) / 5 + 32);
          }

        function getDataAttribute (degrees, percentileValue) {
          if (degrees === 0.5) {
            return "data_baseline_" + percentileValue;
          } else {
            return "data_" + degrees.toString().replace(".", "_") + "c_" + percentileValue;
          }
        };

        function getMapLayerColors (colors, bins, degrees, percentileValue = "mid") {
          const dataAttribute = getDataAttribute(degrees, percentileValue);
          const startIndex = 5;
          const additionalBins = colors
            .slice(startIndex)
            .map((_, index) => [bins[startIndex + index - 1], colors[startIndex + index]]);

          return [
            "step",
            ["get", dataAttribute],
            // color the areas with error values the same as the ocean color
            "#f5f5f5",
            -99999 + 1,
            "#e6e6e6",
            -88888 + 1,
            colors[0],
            bins[0],
            colors[1],
            bins[1],
            colors[2],
            bins[2],
            colors[3],
            bins[3],
            colors[4],
            ...additionalBins.flat(),
          ];
        };

          
          function convertCToF(values) {
            if (values === undefined) {
              return values;
            }
            return Array.isArray(values) ? values.map(cToF) : cToF(values);
          }
          function mmToin(value) {
            return parseFloat((value / 25.4).toFixed(1));
          }
          function convertmmToin(values) {
            if (values === undefined) {
              return values;
            }
            return Array.isArray(values) ? values.map(mmToin) : mmToin(values);
          }
          function getBinLabel(bins, index, unit, minValue, maxValue, step, tempUnit, isDiff=false, isFrequent=false, precipitationUnit, isPrecipitationMap){
            const isTempMap = unit.toLowerCase().includes("temp");

            let finalBins = bins;
            let finalMinValue = minValue;
            let finalMaxValue = maxValue;
            if (isTempMap && tempUnit === "°F") {
              finalBins = convertCToF(bins);
              finalMinValue = convertCToF(minValue);
              finalMaxValue = convertCToF(maxValue);
            } else if (isPrecipitationMap && precipitationUnit === "in") {
              finalBins = convertmmToin(bins);
              finalMinValue = convertmmToin(minValue);
              finalMaxValue = convertmmToin(maxValue);
            }
            const plusSign = isDiff && !isFrequent ? "+" : "";
            const prevBin = finalBins[index - 1];
            const curBin = finalBins[index];

            if (index > bins.length) {
              return [];
            }

            if (index === 0) {
              if (finalMinValue === 0 && finalMinValue === finalBins[index] - 1 && !isDiff) {
                return [finalMinValue.toString()];
              } else if (!isDiff) {
                return [finalMinValue.toString(), parseFloat((curBin - step).toFixed(1)).toString()];
              } else {
                return [curBin > 0 ? "< " + plusSign.concat(curBin.toString()) : "< " + curBin];
              }
            }

            if (!isDiff) {
              const firstBin = prevBin.toString();
              let secondBin = "";

              if (index === finalBins.length) {
                secondBin = finalMaxValue.toString();
              } else {
                secondBin = parseFloat((curBin - step).toFixed(1)).toString();
              }
              return [firstBin, secondBin];
            } else {
              if (index === finalBins.length) {
                return [
                  prevBin - step > 0
                    ? "> " + plusSign.concat(parseFloat((prevBin - step).toFixed(1)).toString())
                    : "> " + parseFloat((prevBin - step).toFixed(1)).toString(),
                ];
              } else {
                if (prevBin === curBin - step) {
                  return [prevBin > 0 ? plusSign.concat(prevBin.toString()) : prevBin.toString()];
                } else {
                  return [
                    prevBin > 0 ? plusSign.concat(prevBin.toString()) : prevBin.toString(),
                    curBin - step > 0 
                      ? plusSign.concat(parseFloat((curBin - step).toFixed(1)).toString())
                      : parseFloat((curBin - step).toFixed(1)).toString(),
                  ];
                }
              }
            }
          };
          function getLabelByValue(value,binningType,binningLabels,stops) {
            if (binningType === "range") {
              let labelIdx = -1;
              stops.forEach((stop, index) => {
                if (labelIdx === -1) {
                  if (index === 0 && value < stop) {
                    labelIdx = 0;
                  } else {
                    const range = [stops[index - 1], stop];
                    if (value >= range[0] && value < range[1]) {
                      labelIdx = index;
                    }
                  }
                }
              });
              if (labelIdx === -1 && value >= stops[stops.length - 1]) {
                labelIdx = stops.length;
              }
              return binningLabels[labelIdx];
            } else if (binningType === "number") {
              let labelIdx = 0;
              stops.forEach((stop, index) => {
                if (stop === value) {
                  labelIdx = index + 1;
                }
              });
              return binningLabels[labelIdx];
            }
          }
          
          function getClimateZoneByValue(datasetDescriptionResponse, midValue) {
            let climateZoneSubGroup;
            datasetDescriptionResponse.climate_zones?.forEach((climateZonesDescription) => {
              climateZonesDescription.list.forEach((climateZone) => {
                if (parseInt(climateZone.value) === midValue) {
                  climateZoneSubGroup = climateZone;
                }
              });
            });
            return climateZoneSubGroup;
          }
          const MAP_VERSION_URL = "https://probablefutures.org/map-version-history";
          const pfLayerIds = ["region-as-oc-1", "region-as-oc-2", "region-as-oc-3", "region-as-oc-4", "region-as-oc-5", "region-as-oc-6", "region-as-oc-7", "region-as-oc-8", "region-eu-af-1", "region-eu-af-2", "region-eu-af-3", "region-eu-af-4", "region-eu-af-5", "region-eu-af-6", "region-eu-af-7", "region-eu-af-8", "region-na-sa-1", "region-na-sa-2", "region-na-sa-3", "region-na-sa-4", "region-na-sa-5", "region-na-sa-6", "region-eu-af-9", "region-na-sa-7", "water"];
          let { dataLayerPaintProperties, dataKey, degrees } = {"dataLayerPaintProperties":["step",["get","data_3c_mid"],"#f5f5f5",-99998,"#e6e6e6",-88887,"#515866",11,"#baaf51",34,"#ffcd29",51,"#ec8a00",68,"#f24822",91,"#922912"],"tempUnit":"°C","degrees":3,"dataKey":"data_3c","precipitationUnit":"mm"};
          let degreesBefore = '1';
          let degreesAfter = '3';
          
          let dataset = {"__typename":"PfMap","mapStyleId":"cli4cyaez00oo01pn4twydvb7","name":"Likelihood of year-plus drought","stops":[11,34,51,68,91],"binHexColors":["#515866","#baaf51","#ffcd29","#ec8a00","#f24822","#922912"],"isDiff":false,"step":1,"binLabels":null,"binningType":"range","slug":"likelihood_of_year-plus_drought","mapVersion":3,"isLatest":true,"dataLabels":["","Average year",""],"methodUsedForMid":"mean","dataset":{"__typename":"PfDataset","id":40702,"name":"Percent of total months with SPEI-12 less than or equal to -0.5","unit":"%","minValue":0,"maxValue":100,"dataVariables":["5th percentile","Average year","95th percentile"],"pfDatasetUnitByUnit":{"__typename":"PfDatasetUnit","unitLong":"Annual likelihood (%)"},"pfDatasetParentCategoryByParentCategory":{"__typename":"PfDatasetParentCategory","name":"land","label":"Maps of dryness"},"subCategory":null}};
          const degreesOptions = [{"value":0.5,"label":"0.5°C","dataKey":"data_baseline","descKey":"description_baseline","year":"Past"},{"value":1,"label":"1°C","dataKey":"data_1c","descKey":"description_1c","year":"Recent"},{"value":1.5,"label":"1.5°C","dataKey":"data_1_5c","descKey":"description_15c","year":"Impending"},{"value":2,"label":"2°C","dataKey":"data_2c","descKey":"description_2c","year":"Potential"},{"value":2.5,"label":"2.5°C","dataKey":"data_2_5c","descKey":"description_25c","year":"Potential"},{"value":3,"label":"3°C","dataKey":"data_3c","descKey":"description_3c","year":"Potential"}];
          mapboxgl.accessToken = 'pk.eyJ1IjoicHJvYmFibGVmdXR1cmVzIiwiYSI6ImNsaThxcXF1YjA5ajgzZHBnemJtNGptMnAifQ.PnPUBROiVfA8wwulm3lghQ';
          let tempUnit = '°C';
          let precipitationUnit = 'mm';
          const isFrequent = dataset?.dataset.unit === "x as frequent";
          const datasetDescriptionResponse = {"dataset_id":"40702","dataset_description":"<p>As mean global temperatures rise, droughts will intensify in most parts of the world. Moderate droughts, as defined by the US Drought Monitor, happened with low frequency in this historical climate (a 21.5% likelihood) and often led to some crop damage and water shortages. For a given month in each warming scenario, the probability that the cumulative conditions from the 12 previous months meet or surpass the historical threshold for “moderate drought” is calculated from climate model projections.</p>\n<p><span style=\"font-weight: 400;\">These maps use the Standardized Precipitation and Evapotranspiration Index (SPEI), which is computed from several meteorological metrics like precipitation and temperature to model how weather impacts terrestrial moisture (in soil, plants, lakes, etc.) </span></p>\n<p><span style=\"font-weight: 400;\">In these maps, drought severity is measured locally and relative to historic conditions. For example, an extreme drought in the Amazon rainforest will be much wetter than an extreme drought in Italy. Similarly, “barren” lands (dry locations without vegetation according to MODIS satellite data) are already consistently dry, so data is not displayed in these places. </span></p>\n<p><span style=\"font-weight: 400;\">The displayed values are from a range of simulated years from multiple models. Actual outcomes may prove to be higher or lower than the displayed values.</span></p>\n","vignette_title_wysiwyg":"<p>Likelihood of year-plus drought</p>\n"};
          const showBorders = true;
          const hideControls = undefined;
          const hideMapLegend = undefined;
          const hideTitle = undefined;
          const hideResetMapButton = true;
          const viewState = {"longitude":24.995521687549882,"latitude":-11.957085562936484,"zoom":4.200000000000001,"pitch":0,"bearing":0,"padding":{"top":0,"bottom":0,"left":0,"right":0}};
          const showPopupOnFirstLoad = undefined;
          let showBaselineDetails = dataset.isDiff && degrees !== 0 && !isFrequent;
          let beforeMap, afterMap;
          let longitude=null, latitude=null, popup=null, mapClicked, featuresBefore=[], featuresAfter=[];
          let { dataKeyBefore, dataKeyAfter, dataLayerPaintPropertiesBefore, dataLayerPaintPropertiesAfter, show: showCompare } = {"show":true,"dataKeyBefore":"data_1c","dataKeyAfter":"data_3c","dataLayerPaintPropertiesBefore":["step",["get","data_1c_mid"],"#f5f5f5",-99998,"#e6e6e6",-88887,"#515866",11,"#baaf51",34,"#ffcd29",51,"#ec8a00",68,"#f24822",91,"#922912"],"dataLayerPaintPropertiesAfter":["step",["get","data_3c_mid"],"#f5f5f5",-99998,"#e6e6e6",-88887,"#515866",11,"#baaf51",34,"#ffcd29",51,"#ec8a00",68,"#f24822",91,"#922912"],"degreesBefore":1,"degreesAfter":3};
          let isTempMap = dataset.dataset.pfDatasetUnitByUnit.unitLong.toLowerCase().includes("temp");
          const isPrecipitationMap = dataset.dataset.unit === "mm";
          let initiallyLoadedInspector = false;
          let beforeMapIsIdle = false;
          let afterMapIsIdle = false;
          function onStyleLoad(map, dataLayerPaintProperties) {
            let { layers } = map?.getStyle();
            layers.forEach(function({id, type}){
              if (id.includes('region-')) {
                map?.setPaintProperty(id, "fill-color", dataLayerPaintProperties);
                map?.setPaintProperty(id, "fill-antialias", ["step", ["zoom"], false, 6, true]);
                map?.setPaintProperty(id, "fill-outline-color", "#ffffff");
              } else if (type === "symbol" || id.includes("road")) {
                map.setLayoutProperty(id, "visibility", "visible");
              } else if (id.includes("boundary")) {
                map.setLayoutProperty(id, "visibility", showBorders ? "visible" : "none");
              }
            });
          }
          function showInspectorOnIdle() {
            if(showPopupOnFirstLoad && !initiallyLoadedInspector) {
              const lat = -11.957085562936484;
              const lng = 24.995521687549882;
              setTimeout(() => {
                beforeMap.fire("click", {
                  lngLat: { lng, lat },
                  point: beforeMap.project({ lng, lat }),
                  originalEvent: {},
                });
                afterMap.fire("click", {
                  lngLat: { lng, lat },
                  point: afterMap.project({ lng, lat }),
                  originalEvent: {},
                });
                initiallyLoadedInspector = true;
              }, 200);
            }
          }
          // initialize beforeMap
          beforeMap = new mapboxgl.Map({
            container: 'beforeMap', style: 'mapbox://styles/probablefutures/cli4cyaez00oo01pn4twydvb7', 
            center: [24.995521687549882,-11.957085562936484], 
            zoom: 4.200000000000001, 
            minZoom: 2.2,
            maxZoom: 10,
            projection: 'mercator'
          });
          if(!hideControls) {
            beforeMap.addControl(new mapboxgl.NavigationControl());
          }
          beforeMap.on("style.load", function() {
            onStyleLoad(beforeMap, dataLayerPaintPropertiesBefore);
          });
          beforeMap.on("idle", function () {
            beforeMapIsIdle = true;
            if(afterMapIsIdle) {
              showInspectorOnIdle();
            }
          });
          // initialize afterMap
          afterMap = new mapboxgl.Map({ 
            container: 'afterMap', style: 'mapbox://styles/probablefutures/cli4cyaez00oo01pn4twydvb7', 
            center: [24.995521687549882, -11.957085562936484], 
            zoom: 4.200000000000001, minZoom: 2.2, maxZoom: 10, projection: 'mercator'});
          if(!hideControls) {
            afterMap.addControl(new mapboxgl.NavigationControl());
          }
          afterMap.on("style.load", function() {
            onStyleLoad(afterMap, dataLayerPaintPropertiesAfter);
          });
          afterMap.on("idle", function () {
            afterMapIsIdle = true;
            if(beforeMapIsIdle) {
              showInspectorOnIdle();
            }
          });
          beforeMap.on('click', pfLayerIds , function(e) {
            latitude = e.lngLat.lat;
            longitude = e.lngLat.lng;
            mapClicked = "before";
            const afterMapFeatures = afterMap.queryRenderedFeatures([e.point.x, e.point.y]);
            featuresBefore = e.features;
            featuresAfter = afterMapFeatures;
            handleMapClick(beforeMap, dataKeyBefore, e.features);
            handleMapClick(afterMap, dataKeyAfter, afterMapFeatures);
          });
          afterMap.on('click', pfLayerIds, function(e) {
            latitude = e.lngLat.lat;
            longitude = e.lngLat.lng;
            mapClicked = "after";
            const beforeMapFeatures = afterMap.queryRenderedFeatures([e.point.x, e.point.y]);
            featuresAfter = e.features;
            featuresBefore = beforeMapFeatures;
            handleMapClick(afterMap, dataKeyAfter, e.features);
            handleMapClick(beforeMap, dataKeyBefore, beforeMapFeatures);
          });
          beforeMap.scrollZoom.disable();
          afterMap.scrollZoom.disable();
          let compareMap = new mapboxgl.Compare(beforeMap, afterMap, "#comparison-container", {});
          if(!hideTitle) {
            
  function displayHeader() {
    const headerDiv = document.createElement("div");
    headerDiv.className = "embeddable-map-header";
    const headerTitle = document.createElement("div");
    headerTitle.className = "embeddable-map-title";
    headerTitle.textContent = "CLIMATE MAP";
    const headerDesc = document.createElement("p");
    headerDesc.className = "embeddable-map-header-description";
    headerDesc.textContent = showCompare ? dataset.name : dataset.name + " in a " + degrees + "°C " + "warming scenario";
    headerDiv.appendChild(headerTitle);
    headerDiv.appendChild(headerDesc);
    document.body.appendChild(headerDiv);
  }

          }
          
  function displayBottomLink() {
    const link = document.createElement("a");
    link.target = "_blank";
    link.target = "noopener noreferrer";
    link.href = MAP_VERSION_URL;
    link.textContent = "Probable Futures map v" + dataset.mapVersion;
    link.className = "embeddable-bottom-link";
    document.body.appendChild(link);
  }

          if(!hideMapLegend) {
            
  function displayClimateZoneKey() {
    const czKeyContainer = document.createElement("div");
    czKeyContainer.className = "climate-zones-key-container";
    const czBinsContainer = document.createElement("div");
    czBinsContainer.className = "cz-bins-container";
    const embeddableKeyContainer = document.createElement("div");
    embeddableKeyContainer.className = "embeddable-key-container";

    let index = 0;
    datasetDescriptionResponse.climate_zones.map(group => {
      const czBinContainer = document.createElement("div");
      czBinContainer.className = "cz-bin-container";
      const czGroupName = document.createElement("div");
      czGroupName.className = "cz-group-name";
      czGroupName.textContent = group.name;
      czBinContainer.appendChild(czGroupName);
      const czColorBinWrapper = document.createElement("div");
      czColorBinWrapper.className = "cz-color-bin-wrapper";

      group.list?.map((climateZone) => {
        const color = dataset.binHexColors[index++];
        const czKeyColor = document.createElement("div");
        czKeyColor.className = "cz-key-color";
        czKeyColor.style.backgroundColor = color;
        czKeyColor.title = climateZone.name;
        czColorBinWrapper.appendChild(czKeyColor);
      });
      czBinContainer.appendChild(czColorBinWrapper);
      czBinsContainer.appendChild(czBinContainer);
    });
    czKeyContainer.appendChild(czBinsContainer);
    embeddableKeyContainer.appendChild(czKeyContainer);
    document.body.appendChild(embeddableKeyContainer);
  }

            
  function displayKeyToggle() {
    const toggleContainer = document.createElement("div");
    const leftToggleLabel = isTempMap ? "°C" : "mm";
    const rightToggleLabel = isTempMap ? "°F" : "in";

    const isChecked = isTempMap ? tempUnit === "°F" : precipitationUnit === "in";
    toggleContainer.className = "embeddable-toggle-container";

    const toggleInput = document.createElement("input");
    toggleInput.className = "embeddable-toggle-input";
    toggleInput.id = "toggle";
    toggleInput.type = "checkbox";
    toggleInput.checked = isChecked;
    toggleInput.addEventListener('change', handleToggleChange);

    const toggleLabel = document.createElement("label");
    toggleLabel.htmlFor = "toggle";
    toggleLabel.className = "embeddable-toggle-label";

    const toggle = document.createElement("div");
    toggle.className = "embeddable-toggle";

    const toggleOptionLeft = document.createElement("span");
    toggleOptionLeft.className = "embeddable-toggle-option";
    toggleOptionLeft.id = "toggle-option1";
    if(isChecked) {toggleOptionLeft.style.color = "#2a172d"}
    else {toggleOptionLeft.style.color = "#fdfdfd"}
    toggleOptionLeft.textContent = leftToggleLabel;

    const toggleOptionRight = document.createElement("span");
    toggleOptionRight.className = "embeddable-toggle-option";
    toggleOptionRight.id = "toggle-option2";
    if(isChecked) {toggleOptionRight.style.color = "#fdfdfd"}
    else {toggleOptionRight.style.color = "#2a172d"}
    toggleOptionRight.textContent = rightToggleLabel;

    const toggleSpan = document.createElement("span");
    toggleSpan.className = "toggle-span";

    toggle.appendChild(toggleOptionLeft);
    toggle.appendChild(toggleOptionRight);
    toggle.appendChild(toggleSpan);
    toggleLabel.appendChild(toggle);

    toggleContainer.appendChild(toggleInput);
    toggleContainer.appendChild(toggleLabel);

    return toggleContainer;
  }

            
  function displayKey() {
    // create main divs
    const embeddableKeyContainer = document.createElement("div");
    embeddableKeyContainer.className = "embeddable-key-container";
    const mapKeyContainer = document.createElement("div");
    mapKeyContainer.className = "map-key-container";
    const keyContent = document.createElement("div");
    keyContent.className = "map-key-content";
    const keyHeader = document.createElement("div");
    keyHeader.className = "map-key-header";
    const label = document.createElement("span");
    label.className = "map-key-label";
    const keyRow = document.createElement("div");
    keyRow.className = "map-key-row";
    keyHeader.appendChild(label);
    keyContent.appendChild(keyHeader);
    keyContent.appendChild(keyRow);
    mapKeyContainer.appendChild(keyContent);
    embeddableKeyContainer.appendChild(mapKeyContainer);
    document.body.appendChild(embeddableKeyContainer);

    if(isTempMap || isPrecipitationMap) {
      keyHeader.appendChild(displayKeyToggle());
    }
    label.textContent = isTempMap ? dataset.dataset.pfDatasetUnitByUnit.unitLong.replace("°C", tempUnit) : dataset.dataset.pfDatasetUnitByUnit.unitLong;

    const binsContainerDiv = document.createElement("div");
    binsContainerDiv.className = "map-key-bins-container";
    dataset.binHexColors.map(function(color, index) {
      const [from, to] = getBinLabel(dataset.stops, index, dataset.dataset.pfDatasetUnitByUnit.unitLong, dataset.dataset.minValue,
        dataset.dataset.maxValue, dataset.dataset.unit === "mm" && precipitationUnit === "in" ? 0.1 : dataset.step,
        tempUnit, dataset.isDiff, isFrequent, precipitationUnit, isPrecipitationMap);
      const binContainerDiv = document.createElement("div");
      const colorDiv = document.createElement("div");
      const binSpan = document.createElement("span");
      binContainerDiv.className = "map-key-bin-container";
      colorDiv.className = "map-key-color";
      binSpan.className = "map-key-bin";
      colorDiv.style.backgroundColor = color;

      if(dataset.binLabels) {
        const innerBinSpan = document.createElement("span");
        innerBinSpan.textContent = dataset.binLabels[index];
        binSpan.appendChild(innerBinSpan);
      } else if (to !== undefined) {
        const innerBinSpan = document.createElement("span");
        innerBinSpan.className = "map-key-inner-bin-label";
        const dashSpan = document.createElement("span");
        const fromText = document.createTextNode(from);
        const toText = document.createTextNode(to);
        dashSpan.textContent = "–";
        innerBinSpan.appendChild(fromText);
        innerBinSpan.appendChild(dashSpan);
        innerBinSpan.appendChild(toText);
        binSpan.appendChild(innerBinSpan);
      } else {
        const innerBinSpan = document.createElement("span");
        innerBinSpan.className = "map-key-inner-bin-label";
        const fromText = document.createTextNode(from);
        innerBinSpan.appendChild(fromText);
        binSpan.appendChild(innerBinSpan);
      }
      binContainerDiv.appendChild(colorDiv);
      binContainerDiv.appendChild(binSpan);
      binsContainerDiv.appendChild(binContainerDiv);
    });
    keyRow.appendChild(binsContainerDiv);
  }

          }
          if(!hideResetMapButton) {
            
  function displayResetButton() {
    const resetDiv = document.createElement("div");
    resetDiv.className = "reset-map-container";
    resetDiv.style.position = "absolute";
    resetDiv.style.right = "20px";
    resetDiv.style.top = "calc(50% + 85px)";
    resetDiv.style.transform = "translateY(-50%)";
    resetDiv.style.zIndex = "1000";
    resetDiv.style.backgroundColor = "white";
    resetDiv.style.borderRadius = "50%";

    const resetButton = document.createElement("button");
    resetButton.className = "reset-map-button";

    resetButton.style.padding = "10px";
    resetButton.style.backgroundColor = "#fdfdfd";
    resetButton.style.border = "none";
    resetButton.style.borderRadius = "50%";
    resetButton.style.width = "35px";
    resetButton.style.height = "35px";
    resetButton.style.display = "flex";
    resetButton.style.alignItems = "center";
    resetButton.style.justifyContent = "center";
    resetButton.style.cursor = "pointer";
    resetButton.style.position = "relative";
    resetButton.style.boxShadow = "0 3px 5px 0 rgb(56 22 63 / 50%)";

    const arrowDiv = document.createElement("div");
    arrowDiv.className = "incomplete-circular-arrow";

    arrowDiv.style.width = "15px";
    arrowDiv.style.height = "11px";
    arrowDiv.style.border = "2px solid transparent";
    arrowDiv.style.borderTopColor = "black";
    arrowDiv.style.borderLeftColor = "black";
    arrowDiv.style.borderBottomColor = "black";
    arrowDiv.style.borderRadius = "50%";
    arrowDiv.style.position = "relative";

    const arrowHead = document.createElement("div");
    arrowHead.className = "arrow-head";

    arrowHead.style.width = "4px";
    arrowHead.style.height = "4px";
    arrowHead.style.borderTop = "2px solid black";
    arrowHead.style.borderRight = "2px solid black";
    arrowHead.style.transform = "rotate(72deg)";
    arrowHead.style.position = "absolute";
    arrowHead.style.top = "-3px";
    arrowHead.style.right = "0px";

    arrowDiv.appendChild(arrowHead);
    resetButton.appendChild(arrowDiv);

    resetButton.addEventListener("click", handleResetButtonClick);

    resetDiv.appendChild(resetButton);
    document.body.appendChild(resetDiv);
  }

          }
          const checkEdgeCaseForPrecipitationBinsAfterConvertingToInch = (value) => {
            if (value === -51 || value === -26) {
              return convertmmToin(value) - 0.1;
            }
            return convertmmToin(value);
          };
          
          function mapPopupVisible (map) {
            return map._popups?.length > 0;
          }

          function getPopupLngLat (map) {
            return map._popups[0]._lngLat;
          }
          
          function handleMapClick(map, key, features) {
            map._popups.forEach(popup => popup.remove());
            if (!key || !features) {
              return;
            }
            let dataFeature = features ? 
              features.find(function(feature) { 
                return feature.layer.id.includes("region-")
              }) 
              : undefined;
            let selectedData = {
              mid:  dataFeature?.properties[key + "_mid"],
              low: dataFeature?.properties[key + "_low"],
              high: dataFeature?.properties[key + "_high"]
            };
            let showInF = isTempMap && tempUnit === "°F";
            const showInInch = isPrecipitationMap && precipitationUnit === "in";
            let isMidValid = selectedData.mid !== undefined && selectedData.mid !== -99999 && selectedData.mid !== -88888;
            let title = "";
            let unit = "";
            if (
              dataset.dataset.unit !== "z-score" &&
              !datasetsWithMidValuesOnly.includes(dataset.dataset.id)
            ) {
              if (isPrecipitationMap) {
                unit = " (" +  precipitationUnit + ") ";
              } else if (isTempMap) {
                unit = " (" +  tempUnit + ") ";
              } else {
                unit = " (" + dataset.dataset.unit + ") ";
              }
            }
            if (dataset.dataset.unit === "class" && dataset.binLabels && isMidValid) {
              title = getClimateZoneByValue(datasetDescriptionResponse,selectedData.mid)?.name || "";
            }
            else if (datasetsWithMidValuesOnly.includes(dataset.dataset.id)) title = "Expected outcome" + unit;
            else title = "Expected range of outcomes" + unit;
            let result = `<div><div class="popover-title">${title}</div>`;
            if (!isMidValid) result += "<span class='popover-no-data'>No data here</span>";
            else if(dataset.dataset.unit === "class") {
              const climateZoneDesc = getClimateZoneByValue(datasetDescriptionResponse, selectedData.mid)?.description || "";
              result += `<div class='popover-description'>${climateZoneDesc}</div>`;
            }
            else {
              let lowValue = selectedData.low,
                highValue = selectedData.high,
                meanValue = selectedData.mid;
              if (showInF) {
                lowValue = convertCToF(selectedData.low);
                highValue = convertCToF(selectedData.high);
                meanValue = convertCToF(selectedData.mid);
              } else if (showInInch) {
                lowValue = checkEdgeCaseForPrecipitationBinsAfterConvertingToInch(selectedData.low);
                highValue = checkEdgeCaseForPrecipitationBinsAfterConvertingToInch(selectedData.high);
                meanValue = checkEdgeCaseForPrecipitationBinsAfterConvertingToInch(selectedData.mid);
              }
              let showMidValueLabel = !dataset?.isDiff || lowValue !== undefined || highValue !== undefined;
              function getMidValue() {
                if (meanValue === undefined) {
                  return null;
                }
                let prefix = "",
                  suffix = "";
                if (isFrequent && meanValue >= 1) {
                  suffix = "x";
                } else if (
                  dataset?.dataset.unit === "mm" &&
                  datasetsWithMidValuesOnly.includes(dataset.dataset.id)
                ) {
                  suffix = " " +  precipitationUnit;
                } else if (dataset?.dataset.unit === "%") {
                  suffix = "%";
                }
                if (showBaselineDetails && meanValue > 0) {
                  prefix = "+";
                }
                return prefix + meanValue + suffix;
              }
              function getValue(value, getter) {
                if (dataset?.binLabels) return getLabelByValue(value, dataset.binningType, dataset.binLabels, dataset.stops);
                else if (getter) return getter();
                return showBaselineDetails && value > 0 ? `+${value}` : value;
              }
              let popoverContent = "<div class='popover-row-container'>";
              let fontSize = dataset.binLabels ? "14px;" : "20px;";
              let fontSizeMid = dataset.binLabels ? "24px;" : "40px;";
              let valueMargin = dataset.binLabels ? "10px 0 4px;" : "18px 0 4px;";
              if(lowValue !== undefined) popoverContent += `<div class="popover-value-container"><span style="font-size:${fontSize};margin:${valueMargin}" class="popover-value">${getValue(lowValue)}</span><span class="popover-label">${dataset?.dataLabels[0]}</span></div>`;
              if(meanValue !== undefined) {
                popoverContent += "<div class='popover-value-container'>";
                if (isFrequent && meanValue < 1) popoverContent += "<span class='popover-mean-frequency-text'>Less frequent</span>";
                else popoverContent += `<span style="font-size:${fontSizeMid}" class="popover-avg-value">${getValue(meanValue, getMidValue)}</span>`
                if(showMidValueLabel) popoverContent+= `<span class="popover-label">${dataset?.dataLabels[1]}</span>`;
                popoverContent += "</div>";
              }
              if(highValue !== undefined) popoverContent += `<div class="popover-value-container"><span style="font-size:${fontSize};margin:${valueMargin}" class="popover-value">${getValue(highValue)}</span><span class="popover-label">${dataset?.dataLabels[2]}</span></div>`;
              popoverContent += "</div>";
              result += popoverContent;
            }
            result += "</div>";
            popup = new mapboxgl.Popup({anchor: "top", maxWidth:"none", focusAfterOpen: false})
            .setLngLat({lng: longitude, lat: latitude})
            .setHTML(result)
            .addTo(map);
            popup.on("close", function(e) {
              handleMapClick(beforeMap);
              handleMapClick(afterMap);
            })
          }
          function handleToggleChange() {
            let isChecked;
            if(isTempMap) {
              tempUnit = tempUnit === "°C" ? "°F" : "°C";
              isChecked = tempUnit === "°F";
            } else {
              precipitationUnit = precipitationUnit === "mm" ? "in" : "mm";
              isChecked = precipitationUnit === "in";
            }
            dataset.binHexColors.map(function(color, index) {
              const [from, to] = getBinLabel(dataset.stops, index, dataset.dataset.pfDatasetUnitByUnit.unitLong, 
                dataset.dataset.minValue, dataset.dataset.maxValue, dataset.dataset.unit === "mm" && precipitationUnit === "in" ? 0.1 : dataset.step,
                tempUnit, dataset.isDiff, isFrequent, precipitationUnit, isPrecipitationMap);
              const innerBinSpan = document.getElementsByClassName("map-key-inner-bin-label")[index];
              if(innerBinSpan) {
                while (innerBinSpan.firstChild) {
                  innerBinSpan.removeChild(innerBinSpan.firstChild);
                }
                const fromText = document.createTextNode(from);
                innerBinSpan.appendChild(fromText);
                if(to !== undefined) {
                  const toText = document.createTextNode(to);
                  const dashSpan = document.createElement("span");
                  dashSpan.textContent = "-";
                  innerBinSpan.appendChild(dashSpan);
                  innerBinSpan.appendChild(toText);
                }
              }
            });
            const toggleOptionLeft = document.getElementById("toggle-option1");
            if(isChecked) toggleOptionLeft.style.color = "#2a172d";
            else toggleOptionLeft.style.color = "#fdfdfd";

            const toggleOptionRight = document.getElementById("toggle-option2");
            if(isChecked) toggleOptionRight.style.color = "#fdfdfd";
            else toggleOptionRight.style.color = "#2a172d";

            const keyLabel = document.getElementsByClassName("map-key-label")[0];
            if (keyLabel) {
              keyLabel.textContent = isTempMap
                ? dataset.dataset.pfDatasetUnitByUnit.unitLong.replace(
                    "°C",
                    tempUnit
                  )
                : dataset.dataset.pfDatasetUnitByUnit.unitLong;
            }
            if (beforeMap._popups.length > 0) handleMapClick(beforeMap, dataKeyBefore, featuresBefore);
            if (afterMap._popups.length > 0) handleMapClick(afterMap, dataKeyAfter, featuresAfter);
          };

          function handleResetButtonClick() {
            const lat = viewState.latitude || 0;
            const lng = viewState.longitude || 0;
            const zoom = viewState.zoom || 2.2;
            beforeMap.flyTo({
              center: [lng, lat],
              zoom,
            });
            afterMap.flyTo({
              center: [lng, lat],
              zoom,
            });

            handleMapClick(beforeMap);
            handleMapClick(afterMap);
            setTimeout(() => {
              beforeMap.fire("click", {
                lngLat: { lng, lat },
                point: beforeMap.project({ lng, lat }),
                originalEvent: {},
              });
            }, 1200);
            
            setTimeout(() => {
              afterMap.fire("click", {
                lngLat: { lng, lat },
                point: afterMap.project({ lng, lat }),
                originalEvent: {},
              });
            }, 1200);
          }

          if(!hideTitle) {
            displayHeader();
          }
          displayBottomLink();
          if(!hideMapLegend) {
            if(dataset.dataset.unit === "class") {
              displayClimateZoneKey();
            }
            else {
              displayKey();
            }
          }
          if(!hideResetMapButton) {
            displayResetButton();
          }
          // event listeners
          window.addEventListener('message', (event) => {
            const { action, degreeBefore, degreeAfter } = event.data;
            if(action === "onDegreeChanged") {
              const [{ dataKey: dataKeyBeforeFromEvent }] = degreesOptions.filter(
                (d) => d.value === degreeBefore
              );
              const [{ dataKey: dataKeyAfterFromEvent }] = degreesOptions.filter(
                (d) => d.value === degreeAfter
              );
              degreesBefore = degreeBefore;
              degreesAfter = degreeAfter;
              dataKeyBefore = dataKeyBeforeFromEvent;
              dataKeyAfter = dataKeyAfterFromEvent;
              dataLayerPaintPropertiesBefore = getMapLayerColors(dataset.binHexColors || [], dataset.stops || [], degreeBefore);
              dataLayerPaintPropertiesAfter = getMapLayerColors(dataset.binHexColors || [], dataset.stops || [], degreeAfter);
              onStyleLoad(beforeMap, dataLayerPaintPropertiesBefore);
              onStyleLoad(afterMap, dataLayerPaintPropertiesAfter);
              const styleSheet = document.getElementById("dynamic-slider-styles").sheet;
              // Remove the old rule (assuming it's the first rule)
              if (styleSheet.cssRules.length > 1) {
                styleSheet.deleteRule(0);
                styleSheet.deleteRule(0);
              }
              // Add the new rule with the updated content
              styleSheet.addRule(
                ".mapboxgl-compare .compare-swiper-vertical::before",
                `content: "${degreesBefore + "°C"}"; left: -71px;`
              );
              styleSheet.addRule(
                ".mapboxgl-compare .compare-swiper-vertical::after",
                `content: "${degreesAfter + "°C"}"; left: 47px;`
              );
              if(mapPopupVisible(beforeMap)) {
                setTimeout(() => {
                  const {lat, lng} = getPopupLngLat(beforeMap);
                  handleMapClick(beforeMap);
                  beforeMap.fire("click", {
                    lngLat: { lng, lat },
                    point: beforeMap.project({ lng, lat }),
                    originalEvent: {},
                  });
                }, 200);
              }
              if(mapPopupVisible(afterMap)) {
                setTimeout(() => {
                  const {lat, lng} = getPopupLngLat(afterMap);
                  handleMapClick(afterMap);
                  afterMap.fire("click", {
                    lngLat: { lng, lat },
                    point: afterMap.project({ lng, lat }),
                    originalEvent: {},
                  });
                }, 200);
              }
            }
          });
        })();
        // apply additional styles if passed.
        const overrideUIStyles = undefined;
        window.onload = function() {
          if(overrideUIStyles?.length) {
            overrideUIStyles.forEach((overrideStyle) => {
              const { selector, styles } = overrideStyle;
              if(selector) {
                const targetElement = document.querySelector(selector);
                if (targetElement && styles) {
                  Object.assign(targetElement.style, styles);
                }
              }
            })
          }
        };
      </script>
    </body>
  </html>